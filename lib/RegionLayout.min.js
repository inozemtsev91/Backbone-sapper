!function(){var a=Backbone.Region=function(a,b){this.selector=a,this.views=[],this.widgets=[],this.$parentEl=b};_.extend(a.prototype,Backbone.Events,{ADD_MODE_WIDGET:"widget",ADD_MODE_APPEND:"append",ADD_MODE_PREPEND:"prepend",$el:function(){return void 0!==this.$parentEl?this.$parentEl.find(this.selector):$(this.selector)},render:function(a,b,c){var d;if(void 0===c&&(c=!0),"function"!=typeof a)throw new TypeError("Region can render Backbone.View or Backbone.Layout");return c&&this.close(),b=b||{},_.extend(b,{el:this.$el(),region:this}),d=new a(b),d._render(),this._addView(d),d},widget:function(a,b){var c;if("function"!=typeof a)throw new TypeError("Region can render Backbone.View or Backbone.Layout");return b=b||{},_.extend(b,{region:this}),c=new a(b),c._render(),this._addView(c),c},renderWidgets:function(a,b,c,d){var e=this.widgets;return(_.isArray(a)||a instanceof Backbone.Collection)&&!_.isUndefined(b)&&a.forEach(function(a,d){this.addWidget(b,_.isFunction(c)?c(a,d):{model:a})}.bind(this)),_.isBoolean(a)&&a?this.$el().prepend(this.widgets):this.$el().append(this.widgets),this.widgets=[],e},_setWrapper:function(a,b){return $('<div class="'+b+'"></div>').append(a)},addView:function(a,b,c,d){var e,f;if("function"!=typeof a)throw new TypeError("Region can render Backbone.View or Backbone.Layout");switch(b=b||{},_.extend(b,{region:this}),e=new a(b),this._addView(e),e._render(),f=d?this._setWrapper(e.el,d):e.el,c){case this.ADD_MODE_WIDGET:this.widgets.push(f);break;case this.ADD_MODE_PREPEND:this.$el().prepend(f);break;case this.ADD_MODE_APPEND:default:this.$el().append(f)}return e},addWidget:function(a,b,c){return this.addView(a,b,this.ADD_MODE_WIDGET,c)},_addView:function(a){this.views.push(a)},close:function(){_.each(this.views,function(a){a.remove()}),this.views=[],this.widgets=[],this.$el().empty()},saving:function(){this.$el().addClass("saving")},loading:function(){this.$el().addClass("loading")},ready:function(){this.$el().removeClass("loading saving")}});var b=Backbone.View.prototype.setElement;_.extend(Backbone.View.prototype,{_render:function(){var b={};return this.regions&&(_.each(this.regions,function(c,d){b[d]=new a(c,this.$el)},this),this.regions=b),this.region=this.options.region,this.render()},renewalRegionsParentEl:function(){this.regions&&_.each(this.regions,function(a){a.$parentEl=this.$el},this)},setElement:function(a,c){return b.apply(this,arguments),this.renewalRegionsParentEl(),this},remove:function(){this.trigger("remove"),_.each(this.regions,function(a){a.close()}),this.region.views=_.without(this.region.views,this),this.region.widgets=_.without(this.region.widgets,this),this.undelegateEvents(),this._removeElement(),this.stopListening()},_removeElement:function(){this.$el.get(0)!=this.region.$el().get(0)?this.$el.remove():this.$el.empty()}})}();